<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns:fx="http://javafx.com/fxml" fx:controller="com.example.philoxapp.organisationSignup.OrganisationSignupStep3Controller"
            prefWidth="900"
            style="-fx-background-color: linear-gradient(to bottom right, #f7f9fc, #e6ebf5);">

    <top>
        <HBox spacing="15" alignment="CENTER_LEFT"
              style="-fx-background-color: white; -fx-padding: 15 30; -fx-border-color: #ddd; -fx-border-width: 0 0 1 0;">
            <ImageView fx:id="logoImage" fitHeight="30" fitWidth="30" />
            <Label text="Philox" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #274C56;" />
            <Region HBox.hgrow="ALWAYS"/>
            <Button fx:id="loginButton" text="Login" onAction="#handleLoginRedirect"
                    style="-fx-background-color: transparent; -fx-border-color: #274C56; -fx-text-fill: #274C56; -fx-border-radius: 6; -fx-font-weight: bold; -fx-font-size: 14px; -fx-padding: 8 24;"/>
        </HBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED"
                    style="-fx-background-color: transparent;">
            <VBox spacing="30" alignment="TOP_CENTER" style="-fx-padding: 30;">

                <!-- Heading and Subtext -->
                <VBox spacing="5" alignment="CENTER">
                    <Label text="Verify Your Organization"
                           style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #274C56;" />
                    <Label text="Provide legal registration and tax details for verification."
                           style="-fx-font-size: 14px; -fx-text-fill: #666;" />
                </VBox>

                <!-- Step Indicator -->
                <HBox alignment="CENTER" spacing="10">
                    <VBox alignment="CENTER" spacing="5">
                        <StackPane>
                            <Circle radius="16" style="-fx-fill: #4CAF50;" />
                            <Text text="✓" style="-fx-fill: white; -fx-font-weight: bold;" />
                        </StackPane>
                        <Label text="Basic Information" style="-fx-font-weight: bold; -fx-text-fill: #4CAF50;" />
                    </VBox>

                    <Region HBox.hgrow="ALWAYS" maxWidth="100" minWidth="50"
                            style="-fx-background-color: #4CAF50; -fx-max-height: 2;" />

                    <VBox alignment="CENTER" spacing="5">
                        <StackPane>
                            <Circle radius="16" style="-fx-fill: #4CAF50;" />
                            <Text text="✓" style="-fx-fill: white; -fx-font-weight: bold;" />
                        </StackPane>
                        <Label text="Online Presence" style="-fx-font-weight: bold; -fx-text-fill: #4CAF50;" />
                    </VBox>

                    <Region HBox.hgrow="ALWAYS" maxWidth="100" minWidth="50"
                            style="-fx-background-color: #4CAF50; -fx-max-height: 2;" />

                    <VBox alignment="CENTER" spacing="5">
                        <StackPane>
                            <Circle radius="16" style="-fx-fill: #009689;" />
                            <Text text="3" style="-fx-fill: white; -fx-font-weight: bold;" />
                        </StackPane>
                        <Label text="Verification &amp; Proofs" style="-fx-font-weight: bold; -fx-text-fill: #274C56;" />
                    </VBox>
                </HBox>

                <!-- Main Form Box -->
                <VBox spacing="25" alignment="TOP_CENTER" maxWidth="800"
                      style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 30;
                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.25), 20, 0.3, 0, 4);">

                    <!-- Registration Details -->
                    <VBox spacing="16">
                        <Label text="Registration Details"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;" />
                        <GridPane hgap="20" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="50" />
                                <ColumnConstraints percentWidth="50" />
                            </columnConstraints>

                            <!-- Row 0 -->
                            <Label text="Registration Authority *" GridPane.rowIndex="0" GridPane.columnIndex="0"
                                   style="-fx-font-weight: bold;" />
                            <Label text="Registration Number *" GridPane.rowIndex="0" GridPane.columnIndex="1"
                                   style="-fx-font-weight: bold;" />

                            <!-- Row 1 -->
                            <ComboBox fx:id="registrationAuthorityField" promptText="Select authority"
                                      GridPane.rowIndex="1" GridPane.columnIndex="0"
                                      style="-fx-padding: 8 12; -fx-background-radius: 8; -fx-border-radius: 8;
                     -fx-border-color: #ccc; -fx-background-color: white;" />
                            <TextField fx:id="registrationNumberField" promptText="Enter registration number"
                                       GridPane.rowIndex="1" GridPane.columnIndex="1"
                                       style="-fx-padding: 10 12; -fx-background-radius: 8; -fx-border-radius: 8; -fx-border-color: #ccc;" />

                            <!-- Row 2: Error label -->
                            <Label fx:id="registrationNumberErrorLabel" text=""
                                   GridPane.rowIndex="2" GridPane.columnIndex="1"
                                   style="-fx-text-fill: red; -fx-font-size: 12px;"
                                   visible="false" managed="false"/>

                            <!-- Row 3 -->
                            <Label text="Date of Registration *" GridPane.rowIndex="3" GridPane.columnIndex="0"
                                   style="-fx-font-weight: bold;" />
                            <Label text="National Tax Number (NTN) *" GridPane.rowIndex="3" GridPane.columnIndex="1"
                                   style="-fx-font-weight: bold;" />

                            <!-- Row 4 -->
                            <DatePicker fx:id="registrationDateField" promptText="Select date"
                                        GridPane.rowIndex="4" GridPane.columnIndex="0"
                                        style="-fx-padding: 4 12; -fx-background-radius: 8; -fx-border-radius: 8;
                       -fx-border-color: #ccc;" />
                            <TextField fx:id="ntnField" promptText="Enter NTN"
                                       GridPane.rowIndex="4" GridPane.columnIndex="1"
                                       style="-fx-padding: 10 12; -fx-background-radius: 8; -fx-border-radius: 8; -fx-border-color: #ccc;" />

                            <!-- Row 5: NTN error label -->
                            <Label fx:id="ntnErrorLabel" text=""
                                   GridPane.rowIndex="5" GridPane.columnIndex="1"
                                   style="-fx-text-fill: red; -fx-font-size: 12px;"
                                   visible="false" managed="false"/>
                        </GridPane>
                    </VBox>
                    <!-- Document Uploads -->
                    <VBox spacing="15" style="-fx-padding: 20 20 0 20;">
                        <Label text="Document Uploads" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;"/>
                        <Label text="Drag and drop files or click to upload. Accepted formats: PDF, JPG, PNG (Max 5MB)" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                        <HBox spacing="20" alignment="TOP_CENTER">
                            <!-- Registration Upload -->
                            <VBox fx:id="regUploadPane" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS"
                                  style="-fx-border-color: #ccc; -fx-border-style: dashed; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 20;">
                                <Text text="&#128228;" style="-fx-font-size: 24px; -fx-fill: #888;"/>
                                <Label text="Proof of Registration" style="-fx-font-weight: bold;"/>
                                <Label text="Upload registration certificate or license" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                                <Button fx:id="uploadRegButton" text="Choose File" onAction="#handleUploadRegistration"/>

                                <HBox fx:id="regFileBox" spacing="5" visible="false" managed="false" alignment="CENTER">
                                    <Label fx:id="regFileNameLabel" text="" style="-fx-text-fill: #4CAF50;"/>
                                    <Button text="×" onAction="#handleRemoveRegFile" style="-fx-background-color: transparent; -fx-text-fill: red; -fx-font-weight: bold;"/>
                                </HBox>
                            </VBox>

                            <!-- Tax Upload -->
                            <VBox fx:id="taxUploadPane" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS"
                                  style="-fx-border-color: #ccc; -fx-border-style: dashed; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 20;">
                                <Text text="&#128228;" style="-fx-font-size: 24px; -fx-fill: #888;"/>
                                <Label text="Tax Document" style="-fx-font-weight: bold;"/>
                                <Label text="Upload NTN certificate or tax proof" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                                <Button fx:id="uploadTaxButton" text="Choose File" onAction="#handleUploadTax"/>

                                <HBox fx:id="taxFileBox" spacing="5" visible="false" managed="false" alignment="CENTER">
                                    <Label fx:id="taxFileNameLabel" text="" style="-fx-text-fill: #4CAF50;"/>
                                    <Button text="×" onAction="#handleRemoveTaxFile" style="-fx-background-color: transparent; -fx-text-fill: red; -fx-font-weight: bold;"/>
                                </HBox>
                            </VBox>

                            <!-- CNIC Upload -->
                            <VBox fx:id="cnicUploadPane" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS"
                                  style="-fx-border-color: #ccc; -fx-border-style: dashed; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 20;">
                                <Text text="&#128228;" style="-fx-font-size: 24px; -fx-fill: #888;"/>
                                <Label text="CNIC of Representative" style="-fx-font-weight: bold;"/>
                                <Label text="Upload copy of representative's CNIC" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                                <Button fx:id="uploadCnicButton" text="Choose File" onAction="#handleUploadCnic"/>

                                <HBox fx:id="cnicFileBox" spacing="5" visible="false" managed="false" alignment="CENTER">
                                    <Label fx:id="cnicFileNameLabel" text="" style="-fx-text-fill: #4CAF50;"/>
                                    <Button text="×" onAction="#handleRemoveCnicFile" style="-fx-background-color: transparent; -fx-text-fill: red; -fx-font-weight: bold;"/>
                                </HBox>
                            </VBox>
                        </HBox>
                    </VBox>
                    <!-- Confirmation Checkbox -->
                    <HBox alignment="CENTER_LEFT">
                        <CheckBox fx:id="confirmationCheckbox"
                                  text="I confirm that all provided information is accurate"
                                  style="-fx-font-size: 13px; -fx-text-fill: #444;" />
                    </HBox>

                    <!-- Navigation Buttons -->
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Button fx:id="submitButton" text="Submit for Verification" onAction="#handleSubmit"
                                prefWidth="200"
                                style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-background-radius: 10;
                                   -fx-font-weight: bold; -fx-font-size: 15px; -fx-padding: 10 0;" />
                        <Button fx:id="backButton" text="Back to Stage 2" onAction="#handleGoBack"
                                prefWidth="140" minHeight="32"
                                style="-fx-background-color: transparent; -fx-border-color: #aaa; -fx-text-fill: #555;
                                   -fx-border-radius: 8; -fx-background-radius: 8; -fx-font-weight: normal;
                                   -fx-font-size: 13px; -fx-padding: 6 12;" />
                    </HBox>

                    <!-- Login Prompt -->
                    <HBox alignment="CENTER" spacing="5" style="-fx-padding-top: 10;">
                        <Label text="Already have an account?" />
                        <Hyperlink text="Login here" onAction="#handleLoginRedirect"
                                   style="-fx-text-fill: #61A04D;" />
                    </HBox>
                </VBox>
            </VBox>
        </ScrollPane>
    </center>
</BorderPane>